{% extends 'base.html.twig' %}

{% block title %}Cambiar contraseña{% endblock %}

{% block body %}
<div class="container min-vh-100 d-flex flex-column justify-content-center align-items-center">
    <div class="card shadow-lg p-4" style="max-width: 420px; width:100%;">
        <div class="text-center mb-3">
            <img src="https://cdn-icons-png.flaticon.com/512/235/235861.png" alt="Hotel Logo" width="60" class="mb-2">
            <h2 class="h5 mb-0 fw-bold">HOTEL CASA REAL NORTE</h2>
            <div class="small text-muted">Cambio de contraseña obligatorio</div>
        </div>

        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }}" role="alert">{{ message }}</div>
            {% endfor %}
        {% endfor %}

        <div class="card-body">
            {{ form_start(changeForm, { 'action': path('app_change_password_submit', {'id': user.id}), 'attr': {'data-turbo': 'false'} }) }}

            {# show repeated-field level errors (e.g. passwords do not match) styled in red #}
            {% set pwdErrors = form_errors(changeForm.plainPassword) %}
            {% if pwdErrors is not empty %}
                <div class="alert alert-danger" role="alert">
                    {{ pwdErrors|raw }}
                </div>
            {% endif %}

            <div class="mb-3">
                {{ form_label(changeForm.plainPassword.first) }}
                {{ form_widget(changeForm.plainPassword.first, { 'attr': {'class': 'form-control'} }) }}
                {# child-level errors (field specific) - show as small text if present, but avoid duplicating repeated-type parent error #}
                {% for e in changeForm.plainPassword.first.vars.errors %}
                    <div class="form-text text-danger">{{ e.message }}</div>
                {% endfor %}
            </div>

            <div class="mb-3">
                {{ form_label(changeForm.plainPassword.second) }}
                {{ form_widget(changeForm.plainPassword.second, { 'attr': {'class': 'form-control'} }) }}
                {% for e in changeForm.plainPassword.second.vars.errors %}
                    <div class="form-text text-danger">{{ e.message }}</div>
                {% endfor %}
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary" style="width:48%; min-width:140px;">Actualizar</button>
                <a href="{{ path('app_login') }}" class="btn btn-secondary" style="width:48%; min-width:140px;">Volver a login</a>
            </div>

            {{ form_end(changeForm) }}
        </div>
    </div>
</div>
{% endblock %}
